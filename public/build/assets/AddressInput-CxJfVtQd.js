import{r as m,b as K,g as U,h as F,M as D,e as $,k as i,o as l,l as c,I as O,i as f,w as E,f as _,c as P,A as y,u as h,E as g,J as R,s as b,F as T,v as q,x as J}from"./app-C5cQoKSN.js";import{_ as X}from"./Input.vue_vue_type_script_setup_true_lang-C-c8gWQF.js";import{d as G}from"./debounce-CMasDNna.js";import{X as H}from"./x-Se0nzd_d.js";import{c as W}from"./createLucideIcon-B-JB_73r.js";import{M as j}from"./map-pin-Bc7WOQHY.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=W("LoaderIcon",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]),Y={class:"relative w-full","data-address-input":""},Z={class:"relative"},ee={class:"flex items-center gap-2"},te=["id"],ae={key:0,class:"py-6 text-center text-sm text-muted-foreground"},oe={class:"flex items-center justify-center"},re=["id"],se={key:2,class:"py-6 text-center text-sm text-muted-foreground"},ne={key:3,class:"max-h-[300px] overflow-y-auto"},le=["aria-selected","onMousedown","onMouseover"],de={class:"flex flex-col gap-0.5"},ue={class:"font-medium"},ie={class:"text-sm text-muted-foreground"},ye={__name:"AddressInput",props:{modelValue:{type:[String,Object],default:null},placeholder:{type:String,default:"Adresse"},minQueryLength:{type:Number,default:3},debounceTime:{type:Number,default:300}},emits:["update:modelValue","error"],setup(w,{emit:A}){const d=w,k=A,u=m(""),r=m([]),v=m(!1),p=m(!1),n=m(""),a=m(-1),x=K(()=>`address-dropdown-${Math.random().toString(36).substr(2,9)}`);U(()=>{document.addEventListener("click",M),V()}),F(()=>{document.removeEventListener("click",M)});function V(){d.modelValue&&(u.value=typeof d.modelValue=="string"?d.modelValue:d.modelValue.name||"")}function M(e){e.target.closest("[data-address-input]")||(v.value=!1,a.value=-1)}function L(e){r.value.length&&(e==="next"?a.value=a.value<r.value.length-1?a.value+1:0:a.value=a.value>0?a.value-1:r.value.length-1)}function C(){a.value>=0&&r.value[a.value]&&S(r.value[a.value])}function z(){v.value=!1,a.value=-1}const B=G(async e=>{var t;if(e.length<d.minQueryLength){r.value=[];return}p.value=!0,n.value="";try{const o=await D.get(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(e)}&limit=5`,{timeout:5e3});r.value=(t=o.data.features)!=null&&t.length?o.data.features.map(s=>({id:s.properties.id,name:s.properties.name,housenumber:s.properties.housenumber,street:s.properties.street,city:s.properties.city,postcode:s.properties.postcode,context:s.properties.context,type:s.properties.type,coordinates:{lat:s.geometry.coordinates[1],lng:s.geometry.coordinates[0]}})):[]}catch(o){console.error("Error fetching address suggestions:",o),n.value="Une erreur est survenue lors de la recherche. Veuillez réessayer.",k("error",n.value),r.value=[]}finally{p.value=!1}},d.debounceTime);function S(e){const t=[e.housenumber,e.street].filter(Boolean);u.value=t.join(" "),v.value=!1,n.value="",a.value=-1,k("update:modelValue",{name:t.join(" "),street:e.street,housenumber:e.housenumber,city:e.city,postcode:e.postcode,departement:e.postcode.substring(0,2),context:e.context,type:e.type,lat:e.coordinates.lat,lng:e.coordinates.lng})}function N(){u.value="",r.value=[],v.value=!1,n.value="",k("update:modelValue",null)}return $(()=>d.modelValue,V),$(u,e=>{e.length>=d.minQueryLength?B(e):r.value=[]}),(e,t)=>(l(),i("div",Y,[c("div",Z,[f(h(X),{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=o=>u.value=o),type:"text",placeholder:w.placeholder,disabled:p.value,"aria-expanded":v.value,"aria-controls":x.value,"aria-describedby":n.value?`${x.value}-error`:void 0,role:"combobox",onFocus:t[1]||(t[1]=o=>v.value=!0),onKeydown:[t[2]||(t[2]=g(y(o=>L("next"),["prevent"]),["down"])),t[3]||(t[3]=g(y(o=>L("prev"),["prevent"]),["up"])),g(y(C,["prevent"]),["enter"]),g(z,["esc"])]},{prefix:E(()=>[f(h(j),{class:"h-5 w-5 text-muted-foreground","aria-hidden":"true"})]),suffix:E(()=>[c("div",ee,[u.value?(l(),i("button",{key:0,onClick:y(N,["prevent"]),class:"text-muted-foreground hover:text-foreground","aria-label":"Effacer la recherche"},[f(h(H),{class:"h-4 w-4"})])):_("",!0),p.value?(l(),P(h(I),{key:1,class:"h-4 w-4 animate-spin","aria-hidden":"true"})):_("",!0)])]),_:1},8,["modelValue","placeholder","disabled","aria-expanded","aria-controls","aria-describedby","onKeydown"])]),O(c("div",{id:x.value,class:"absolute z-50 w-full mt-1 bg-background rounded-md border shadow-md",role:"listbox"},[p.value?(l(),i("div",ae,[c("div",oe,[f(h(I),{class:"h-4 w-4 animate-spin","aria-hidden":"true"}),t[4]||(t[4]=c("span",{class:"ml-2"},"Recherche en cours...",-1))])])):n.value?(l(),i("div",{key:1,id:`${x.value}-error`,class:"py-6 text-center text-sm text-destructive"},b(n.value),9,re)):r.value.length===0&&u.value.length>=w.minQueryLength?(l(),i("div",se," Aucun résultat trouvé ")):r.value.length>0?(l(),i("div",ne,[(l(!0),i(T,null,q(r.value,(o,s)=>(l(),i("div",{key:o.id,class:J(["flex items-center gap-2 px-4 py-2 cursor-pointer",["hover:bg-accent hover:text-accent-foreground",{"bg-accent text-accent-foreground":a.value===s}]]),role:"option","aria-selected":a.value===s,onMousedown:y(Q=>S(o),["prevent"]),onMouseover:Q=>a.value=s},[f(h(j),{class:"h-4 w-4 text-muted-foreground","aria-hidden":"true"}),c("div",de,[c("span",ue,b(o.name),1),c("span",ie,b(o.city)+", "+b(o.postcode),1)])],42,le))),128))])):_("",!0)],8,te),[[R,v.value&&(p.value||n.value||r.value.length>0)]])]))}};export{ye as _};
